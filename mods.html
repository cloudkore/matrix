<!DOCTYPE html>
<html lang="en">
<head>
    <title>NinjaBase</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap.css" rel="stylesheet" media="screen">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="js/essentials.js"></script>
    <script src="js/fileList.js"></script>

    <style>
        /* Style for search bar */
        #searchBar {
            margin-bottom: 20px;
        }

        /* Style for black container */
        #fileContainer {
            background-color: black;
            padding: 20px;
            border-radius: 10px;
        }

        /* Style for download button */
        .download-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }

        .download-btn.loading {
            background-color: green !important; /* Change button color to green when loading */
        }

        .download-btn:hover {
            background-color: #0056b3;
        }

        /* Style to align download buttons to the right */
        #fileList li {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #fileList li .download-btn {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Placeholder for the navbar -->
    <div id="navbar-placeholder"></div>

    <!-- Black container for the file list -->
    <div id="fileContainer">
        <!-- Search Bar -->
        <input type="text" id="searchBar" placeholder="Search files...">

        <ul id="fileList">
            <!-- File list items will be added dynamically here -->
        </ul>
    </div>

    <!-- Placeholder for the footer -->
    <div id="footer-placeholder"></div>

    <!-- Include Bootstrap JS if needed -->
    <script src="js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function(){
            $('#searchBar').on('input', function() {
                var searchText = $(this).val().toLowerCase();
                $('#fileList li').each(function() {
                    var fileName = $(this).text().toLowerCase();
                    if(fileName.includes(searchText)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });

            function fetchFiles() {
                const repoOwner = 'cloudkore'; // Replace with the owner of the repository
                const repoName = 'matrix'; // Replace with the name of the repository
                const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/data/MODs`;

                fetch(apiUrl)
                    .then(response => response.json())
                    .then(data => {
                        const fileListElement = $('#fileList');
                        fileListElement.empty();

                        data.forEach(file => {
                            const downloadBtn = $('<button>').addClass('download-btn').text('Download');
                            downloadBtn.click(function() {
                                $(this).addClass('loading').text('Loading:'); // Add loading class and change button text to "Loading"
                                downloadFile(file.download_url, file.name, $(this)); // Pass the button element to downloadFile function
                            });

                            const listItem = $('<li>').text(file.name).append(downloadBtn);
                            fileListElement.append(listItem);
                        });
                    })
                    .catch(error => console.error('Error fetching repository files:', error));
            }

            fetchFiles();

            function downloadFile(url, fileName, buttonElement) {
                console.log('Downloading ' + fileName);
                // Simulate loading delay (2 seconds)
                setTimeout(function() {
                    window.open(url, '_blank');
                    buttonElement.removeClass('loading').text('Download'); // Remove loading class and revert button text back to "Download"
                }, 2000);
            }
        });
    </script>
</body>
</html>